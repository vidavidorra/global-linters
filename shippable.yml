language: node_js
node_js:
  - '12.8.0'

env:
  global:
    - TEST_RESULTS_DIR="$SHIPPABLE_REPO_DIR/shippable/testresults"
    - CODE_COVERAGE_DIR=${SHIPPABLE_REPO_DIR}/shippable/codecoverage

build:
  ci:
    - npm ci
    - npm run build
    - mkdir -p "${TEST_RESULTS_DIR}"
    - mkdir -p "${CODE_COVERAGE_DIR}"
    - >
      JEST_JUNIT_OUTPUT="${TEST_RESULTS_DIR}/tests.xml" npm run test:ci
      -- --coverageDirectory "${CODE_COVERAGE_DIR}"

integrations:
  notifications:
    - integrationName: email
      type: email
      recipients:
        - '--last_committer'
        - '--last_author'
      sendConsoleLogs: true
